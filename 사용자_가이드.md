# PDF 자동 태깅 시스템 사용자 가이드

## 📋 목차

1. [시작하기](#시작하기)
2. [설치](#설치)
3. [사용법](#사용법)
4. [문제 해결](#문제-해결)
5. [FAQ](#faq)

---

## 🚀 시작하기

### 필수 요구사항

- **Windows 10 이상**
- **Python 3.10 이상** ([다운로드](https://www.python.org/downloads/))
- **OpenAI API 키** ([발급 방법](https://platform.openai.com/api-keys))

### 빠른 시작

1. Python 설치 (아직 설치하지 않은 경우)
2. `setup.bat` 실행 (최초 1회만)
3. `run.bat` 실행하여 PDF 처리

---

## 📦 설치

### 자동 설치 (권장)

1. **setup.bat 실행**
   ```
   setup.bat를 더블클릭하거나 명령 프롬프트에서 실행
   ```

2. **설정 완료 대기**
   - 자동으로 가상환경 생성
   - 필요한 패키지 설치
   - 약 5-10분 소요 (인터넷 속도에 따라 다름)

### 수동 설치

명령 프롬프트에서 다음 명령 실행:

```bash
# 1. 가상환경 생성
python -m venv venv

# 2. 가상환경 활성화
venv\Scripts\activate

# 3. 패키지 설치
pip install -r requirements.txt

# 4. 개발 모드 설치
pip install -e .
```

---

## 💻 사용법

### 방법 1: 배치 파일 사용 (가장 간단)

#### 대화형 실행

1. **run_interactive.bat** 더블클릭
2. API 키 입력 (최초 1회)
3. 입력 PDF 파일 경로 입력
4. 출력 PDF 파일 경로 입력 (선택사항)
5. 처리 완료 대기

#### 명령줄 실행

명령 프롬프트에서:

```bash
run.bat input.pdf output.pdf
```

또는 출력 파일을 지정하지 않으면 `input_tagged.pdf`로 저장:

```bash
run.bat input.pdf
```

---

## 🧭 배치 파일 실행 및 활용 가이드 (상세)

### 1) setup.bat (최초 1회)
**목적:** 실행에 필요한 가상환경과 패키지 설치  
**실행 방법:** 더블클릭 또는 명령 프롬프트에서 `setup.bat` 실행  
**완료 기준:** “설정 완료!” 메시지가 출력되면 준비 완료입니다.

### 2) run_interactive.bat (추천)
**목적:** 초보 사용자용 대화형 실행  
**흐름:**
1. `run_interactive.bat` 실행
2. OpenAI API 키 입력
3. 입력 PDF 경로 입력
4. 출력 PDF 경로 입력 (Enter 시 자동 생성)
5. 처리 완료 메시지 확인

**팁:**  
- PDF 파일을 콘솔 창으로 드래그 & 드롭하면 경로가 자동 입력됩니다.  
- 출력 경로를 비워두면 `입력파일명_tagged.pdf`로 저장됩니다.

### 3) run.bat (명령줄 자동화용)
**목적:** 스크립트/자동화에서 반복 실행  
**형식:**
```bash
run.bat "입력파일.pdf" "출력파일.pdf"
```
출력 파일을 생략하면 기본값으로 저장됩니다.

### 4) 여러 파일 일괄 처리 예시
```bash
run.bat file1.pdf file1_tagged.pdf
run.bat file2.pdf file2_tagged.pdf
run.bat file3.pdf file3_tagged.pdf
```

### 5) 자주 겪는 오류와 해결
- **API 키 입력 오류:** 환경변수 `OPENAI_API_KEY`를 미리 설정하면 입력 없이 실행됩니다.
- **파일 경로 오류:** 공백이 있는 경로는 반드시 따옴표로 감싸주세요.
- **패키지 설치 오류:** 인터넷 연결을 확인하고 `setup.bat` 재실행을 권장합니다.

### 방법 2: Python 직접 실행

```bash
# 가상환경 활성화
venv\Scripts\activate

# 실행
python -m src.main input.pdf output.pdf
```

### 방법 3: 환경변수 사용

1. **환경변수 설정** (시스템 속성 > 환경 변수)
   - 변수명: `OPENAI_API_KEY`
   - 변수값: `sk-...` (OpenAI API 키)

2. **실행**
   ```bash
   run.bat input.pdf output.pdf
   ```

### 방법 4: Linux/macOS용 스크립트 실행

1. 실행 권한 부여:
   ```bash
   chmod +x setup.sh run.sh
   ```
2. 최초 1회 설정:
   ```bash
   ./setup.sh
   ```
3. 실행:
   ```bash
   ./run.sh input.pdf output.pdf
   ```

### 방법 5: 폴더 배치 처리

```bash
python -m src.main /path/to/pdf_folder /path/to/output_dir
```

출력 경로를 생략하면 `outputs` 폴더가 생성됩니다.

### 방법 6: ESG 배치 자동화 실행

```bash
python scripts/esg_batch.py /path/to/pdf_folder /path/to/output_dir --config config/config.yaml --api-key "$OPENAI_API_KEY"
```

이 모드는 taxonomy 자동 업데이트(선택), taxonomy 검증, PDF 사전 검사, 매핑 차이 리포트를 포함합니다.
taxonomy 업데이트 사용 시 `taxonomy.url`과 `taxonomy.checksum_sha256`를 설정하면 무결성 검증과 버전 기록이 추가됩니다.
`summary_report.json`으로 taxonomy 변경 감지 및 매핑 diff 요약이 제공됩니다.

---

## 🔧 고급 사용법

### 설정 파일 사용

1. `config/config.yaml` 파일 편집
2. 실행:
   ```bash
   python -m src.main input.pdf output.pdf --config config/config.yaml
   ```

### ESG Taxonomy 매핑 (IFRS/ISSB)

1. IFRS/ISSB taxonomy 패키지를 준비합니다.
2. `config/config.yaml`에서 아래 항목을 설정합니다:
   ```yaml
   taxonomy:
     root: "/path/to/ifrs-taxonomy"
   output:
     dir: "outputs"
   ```
3. 실행 후 다음 파일이 생성됩니다:
   - `{stem}_structure.xml`
   - `{stem}_mapping.json`
   - `processing_report.json`

### 상세 로그 출력

```bash
python -m src.main input.pdf output.pdf --verbose
```

---

## ❓ 문제 해결

### Python이 설치되지 않음

**증상**: "Python이 설치되지 않았습니다" 오류

**해결**:
1. [Python 공식 사이트](https://www.python.org/downloads/)에서 다운로드
2. 설치 시 "Add Python to PATH" 옵션 체크
3. 설치 후 명령 프롬프트 재시작

### 패키지 설치 실패

**증상**: "패키지 설치 실패" 오류

**해결**:
1. 인터넷 연결 확인
2. 방화벽/프록시 설정 확인
3. 관리자 권한으로 실행
4. 수동 설치 시도:
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

### pyproject.toml 메타데이터 오류

**증상**: `Preparing metadata (pyproject.toml) ... error` 출력  
**참고**: `metadata-generation-failed`가 특정 패키지(예: PyMuPDF)에서 발생할 수 있으며, 이는 pip 자체 문제가 아닐 수 있습니다.  
**해결**:
1. 빌드 도구 업데이트:
   ```bash
   python -m pip install --upgrade pip setuptools wheel
   ```
2. 빌드 격리 비활성화 후 재시도:
   ```bash
   pip install -r requirements.txt --no-build-isolation
   ```
3. 계속 실패하면 오류 로그에서 **실패한 패키지 이름**(예: PyMuPDF)을 확인해 해당 패키지의 설치 가이드를 참고하세요.

### API 키 오류

**증상**: "API 키가 필요합니다" 또는 API 호출 실패

**해결**:
1. OpenAI API 키 확인 ([발급 페이지](https://platform.openai.com/api-keys))
2. API 키 형식 확인 (`sk-`로 시작해야 함)
3. 환경변수 설정 확인:
   ```bash
   echo %OPENAI_API_KEY%
   ```
4. API 키에 충분한 크레딧이 있는지 확인

### 파일 경로 오류

**증상**: "파일을 찾을 수 없습니다" 오류

**해결**:
1. 파일 경로에 공백이 있으면 따옴표 사용:
   ```bash
   run.bat "C:\My Documents\input.pdf" "C:\My Documents\output.pdf"
   ```
2. 파일 확장자 확인 (.pdf)
3. 파일이 다른 프로그램에서 열려있지 않은지 확인

### 메모리 부족

**증상**: 처리 중 메모리 오류

**해결**:
1. 다른 프로그램 종료
2. 더 작은 PDF로 테스트
3. 시스템 메모리 확인 (최소 8GB 권장)

---

## 📝 FAQ

### Q: 처리 시간이 얼마나 걸리나요?

A: PDF 크기와 복잡도에 따라 다릅니다:
- 1-5페이지: 약 30초-2분
- 10-20페이지: 약 2-5분
- 50페이지 이상: 10분 이상

OpenAI API 응답 시간도 영향을 줍니다.

### Q: 비용이 얼마나 드나요?

A: OpenAI API 사용 비용이 발생합니다:
- GPT-4 Turbo: 약 $10-30 per 1M tokens
- GPT-4 Vision: 약 $10-50 per 1M tokens
- 일반적인 PDF 1개: 약 $0.01-0.10

### Q: 오프라인에서 사용할 수 있나요?

A: 아니요. GPT-4 API 통신이 필요합니다.

### Q: 어떤 PDF 형식이 지원되나요?

A: 표준 PDF 형식 (PDF 1.4 이상)
- 텍스트 기반 PDF (권장)
- 이미지 스캔 PDF (OCR 필요 시 추가 처리 필요)
- 암호화된 PDF는 지원하지 않음

### Q: 한글 PDF를 지원하나요?

A: 네, 한글 PDF를 지원합니다.

### Q: 생성된 PDF를 Adobe Acrobat에서 확인할 수 있나요?

A: 네, 표준 PDF 형식이므로 모든 PDF 뷰어에서 열 수 있습니다.

### Q: 처리된 PDF의 품질을 확인하려면?

A: 다음 도구를 사용할 수 있습니다:
- Adobe Acrobat Pro (접근성 검사)
- PAC 3 (PDF Accessibility Checker)
- 자동 검증 기능 (기본 포함)

---

## 📞 지원

### 문제 신고

GitHub 이슈에 문제를 신고해주세요:
- 오류 메시지 포함
- 사용한 PDF 파일 정보 (크기, 페이지 수)
- 실행 환경 정보 (Python 버전, OS 버전)

### 기능 요청

새로운 기능이나 개선 사항을 제안해주세요.

---

## 📄 라이선스

MIT License

---

## 🔗 관련 링크

- [프로젝트 README](README.md)
- [변경 이력](CHANGELOG.md)
- [Python 공식 사이트](https://www.python.org/)
- [OpenAI API 문서](https://platform.openai.com/docs/)
